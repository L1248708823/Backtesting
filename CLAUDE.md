# Claude 项目上下文 - 量化回测系统
> **文件别名**: 项目大脑.md / AI记忆库.md (中文友好称呼)

## 🎭 团队角色系统
我是项目的总设计师，拥有四名专业员工：
- **产品经理** - 负责需求分析和PRD文档 (已完成 ✅)
- **架构师** - 负责架构验证和细化设计 (待启动 🔥)
- **UI/UX设计师** - 负责设计规范和交互设计 (待启动 ⏳)  
- **全栈开发工程师** - 负责前后端代码实现和技术交付 (待启动 ⏳)

### 团队指令系统
- `/产品` - 切换到产品经理角色
- `/架构` - 切换到架构师角色 🔥
- `/设计` - 切换到UI/UX设计师角色  
- `/开发` - 切换到前端开发工程师角色

## 📋 项目当前状态

### 🎯 项目概述
- **项目名称**: 量化回测系统 (Quantitative Backtesting System)
- **目标**: 个人专用的ETF轮动等策略回测验证平台
- **用户**: 具备编程背景的个人投资者 + 程序员朋友

### ✅ 已完成阶段

#### 1. 需求分析阶段 (已完成 2024-08-11)
- ✅ 深度需求澄清和分析
- ✅ 技术方案对比和选择
- ✅ PRD.md 产品需求文档已生成
- ✅ 市场调研和竞品分析

#### 2. 项目初始化阶段 (已完成 2024-08-11)
- ✅ Monorepo 项目结构创建
- ✅ 后端 Python + FastAPI 环境搭建
- ✅ 前端 React + TypeScript 环境搭建  
- ✅ Docker 容器化配置
- ✅ 开发工具和代码规范设置
- ✅ 项目文档和快速启动指南

#### 3. 架构发现阶段 (已完成 2024-08-11)
- ✅ 发现架构师角色缺失的关键问题
- ✅ 分析现有代码架构框架 (策略抽象、参数系统、回测引擎)
- ✅ 识别架构验证的优先级和必要性
- ✅ 确立架构验证优先于功能实现的策略

### 🚀 技术架构决策

#### 核心架构
- **项目结构**: Monorepo + 前后端分离
- **后端技术栈**: Python + FastAPI + Backtrader + SQLite
- **前端技术栈**: React + TypeScript + Ant Design + ECharts  
- **容器化**: Docker + Docker Compose
- **数据源**: AKShare(A股) + yfinance(美股) - 免费方案

#### 关键技术决策记录
1. **为什么选择Monorepo**: 便于版本同步、统一部署、代码复用
2. **为什么选择Backtrader**: 2024年最佳回测框架，社区活跃，灵活性高
3. **为什么前后端分离**: 避免后期重构，支持独立扩展
4. **为什么选择免费数据源**: MVP阶段成本控制，后期可升级付费

### 📁 重要文件索引

#### 🧠 项目管理核心
- **`CLAUDE.md`** (本文件) - 项目上下文和状态概览 🧠
- **`TODO.md`** - 详细任务管理和进度跟踪 📋
  - ⚠️ **重要**: 每次对话必须检查TODO.md了解最新任务进度
  - 包含：已完成任务、进行中任务、待办事项、优先级管理
  - 提供：具体行动指导和下一步工作计划

#### 核心文档
- `PRD.md` - 完整产品需求文档 📋
- `README.md` - 项目说明和概览 📖  
- `QUICKSTART.md` - 快速启动指南 🚀
- `docs/development.md` - 详细开发指南 🛠️

#### 配置文件
- `docker-compose.yml` - 容器编排配置 🐳
- `backend/requirements.txt` - Python依赖 🐍
- `frontend/package.json` - Node.js依赖 📦

#### 团队文档
- `md/团队规则.md` - 团队协作规则
- `md/产品经理系统提示词.md` - 产品经理角色定义
- `md/架构师系统提示词.md` - 架构师角色定义 🔥
- `md/设计师系统提示词.md` - 设计师角色定义  
- `md/全栈开发工程师系统提示词.md` - 全栈开发工程师角色定义

### 🎯 当前项目状态

#### 可启动功能
- ✅ **Docker 一键启动**: `docker-compose up -d`
- ✅ **API 服务**: http://localhost:8008 (FastAPI)
- ✅ **Web 界面**: http://localhost:3000 (React)
- ✅ **API 文档**: http://localhost:8008/docs
- ✅ **基础策略**: 定投策略完整实现
- ✅ **类型系统**: 前后端类型完全统一

#### 核心API已实现
- `/api/v1/dca/` - 定投策略专用API (完整实现)
- `/api/v1/strategies/` - 策略管理 (基础框架)
- `/api/v1/backtest/` - 通用回测 (基础框架)
- `/api/v1/data/` - 数据管理 (基础框架)

#### 🔥 架构优化成果 (2024-08-27 新增)
- **类型统一**: 建立Python First类型生成系统
- **模型清理**: 消除后端重复定义，统一schema结构
- **自动化**: generate_types.py脚本自动生成前端类型
- **零重复**: 前后端共享同一套数据模型定义

### 📍 下一步工作计划

#### 🔥 架构重构阶段 (当前阶段 🔥)
**触发指令**: 基于Backtrader重建后端架构
**优先级**: 最高 - 修复架构根本问题
**工作内容**:
1. ✅ 删除所有过度抽象的后端代码
2. ✅ 创建极简main.py框架
3. ✅ 启用backtrader==1.9.78.123依赖
4. 🔄 设计新的极简架构
5. ⏳ 基于Backtrader实现DCA策略
6. ⏳ 创建极简API接口

#### 🔧 系统完善阶段 (下一阶段)
**触发指令**: `/开发`
**优先级**: 中 - 提升用户体验和系统稳定性
**工作内容**:
1. 完善错误处理和稳定性优化
2. 补充单元测试和集成测试
3. 性能优化和用户体验提升
4. 生产部署准备

#### 🎨 设计阶段 (后续阶段)
**触发指令**: `/设计`
**工作内容**:
1. 读取PRD.md理解产品需求
2. 收集用户设计偏好  
3. 制定设计策略和视觉规范
4. 生成DESIGN_SPEC.md设计文档
5. 为开发团队提供完整设计指导

#### 💻 开发阶段 (最后阶段)  
**触发指令**: `/开发`
**工作内容**:
1. 基于验证的架构和UI设计实现前后端功能
2. 集成回测引擎Backtrader和数据源接入
3. 完善API功能、错误处理和系统集成
4. 添加测试、性能优化和部署配置

### 🔄 工作流程状态
```
需求分析 ✅ → 项目初始化 ✅ → 架构重构 🔥 → Backtrader集成 ⏳ → 策略重建 ⏳ → 系统验证 ⏳ → 生产部署 ⏳
```

### ⚠️ 重要提醒

#### 用户偏好记录
- 偏好Monorepo架构 (类似Element Plus)
- 要求前后端分离避免后期拆分
- 期望Web界面 + 本地运行
- 目标用户：自己 + 程序员朋友
- 主要测试A股和美股ETF轮动策略

#### 学习项目特点 🎓
- **用户是Python和React新手** - 需要详细的代码说明和注释
- **实践+学习并重** - 代码要能跑，更要理解原理
- **架构思维优先** - 关注"为什么这样设计"而不只是"怎么实现" 🔥
- **系统设计理念** - 重视通用性、扩展性、可维护性
- **注释策略**: 配置文件详细说明，关键概念解释，最佳实践说明
- **踩坑提醒**: 主动指出新手易犯错误和解决方案
- **技术选择说明**: 每个决策都要解释为什么这样做

#### 🎯 代码注释和工作规范 (2024-08-26 新增)
- **TypeScript/JavaScript注释规范**: 
  - 所有接口定义(interface)必须有完整的JSDoc中文注释
  - 重要配置参数和选项必须有详细说明（取值范围、使用建议）
  - 复杂业务逻辑必须有注释解释
  - 格式：`/** 参数说明 - 详细解释，包含取值范围和使用建议 */`
  - 目的：方便用户在VSCode中hover查看，无需查找文档
- **Python代码注释规范**:
  - 类和重要方法必须有详细的docstring
  - 复杂算法和业务逻辑必须有中文注释
  - 参数定义和配置项必须有完整说明
- **特殊要求识别机制**:
  - 用户提出特殊要求时，主动识别是否为通用规则
  - 不确定是否写入规则时，主动询问用户确认
  - 确保重要工作规范不被遗漏

#### 技术约束
- 使用免费数据源 (成本控制)
- 支持策略可配置但不支持在线编辑
- 暂不支持多用户系统
- MVP版本使用SQLite，后期可升级PostgreSQL

#### 环境信息 🖥️
- **用户系统**: Windows + PowerShell
- **我的运行环境**: WSL Ubuntu (注意命令差异！)
- **Python环境**: Python 3.13.3 (用 `py -3` 调用)
- **Node.js**: 需要升级到18+ (当前16有兼容性问题)

### 🎛️ 快速恢复指令

当用户下次对话时，我应该：
1. **读取项目上下文**: 先读取项目大脑.md(CLAUDE.md)了解项目整体状态
2. **检查任务进度**: 必须读取TODO.md获取最新任务进度和具体待办事项
3. **识别下一步**: 基于两个文档的信息确定当前阶段和优先任务
4. **提供选择**: 
   - 输入 `/架构` 开始架构验证工作 🔥 **推荐优先**
   - 或先用 `docker-compose up -d` 测试当前功能
   - 或输入 `/设计` 开始UI设计工作
   - 或查看TODO.md中的具体任务列表

### 🧠 关键架构发现 (2024-08-11)
- **现有架构框架评估**: 策略抽象、参数系统、回测引擎已设计，但**未验证可行性**
- **风险识别**: 架构问题如果后期发现，重构成本极高
- **策略决策**: 架构验证优先于功能实现和UI设计
- **学习价值**: 架构设计思维 > 单纯的功能实现

### 📊 项目成熟度评估 (2024-09-02 重构后)
- **需求clarity**: 95% (PRD完整)
- **技术架构**: 20% (正在基于Backtrader重构) 🔥
- **后端实现**: 10% (已清理，待重建) 🔄
- **前端实现**: 80% (保持现状，待适配)
- **UI设计**: 90% (DESIGN_SPEC.md完整)
- **数据源**: 60% (需要重新集成到Backtrader)
- **文档同步**: 70% (正在更新中) 🔄

---
**最后更新**: 2024-09-02
**当前责任人**: 总设计师 → 架构重构阶段 🔥
**下次建议**: 基于Backtrader设计极简API架构，重建DCA策略
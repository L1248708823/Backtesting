# 🏗️ 架构资产清单 (Architecture Registry)

> **目标**: 避免"前脚定义后脚遗忘"问题，提供全面的组件/工具复用指南
> **维护**: 每次新增功能/组件后必须同步更新此文档
> **使用**: 开发前强制检查此清单，避免重复造轮子

---

## 📋 **使用指南**

### 🔍 **开发前必检流程**
1. **搜索关键词**: 在本文档中搜索相关功能描述
2. **检查对应章节**: 确认是否有现成的组件/工具可复用
3. **代码位置确认**: 根据文件路径找到具体实现
4. **复用或抽象决策**: 如发现重复模式，立即咨询用户意见

---

## 🎯 **前端架构资产**

### 📡 **API服务层** (`/frontend/src/services/`)

#### `api.ts` - 统一HTTP客户端 ⭐⭐⭐
**功能**: axios实例配置 + 全局错误处理拦截器
**特色**: 
- 自动环境变量适配 (开发/生产)
- 统一错误处理 (400/404/500状态码)
- 增强错误对象 (包含status、response等属性)
**使用场景**: 所有API调用的基础，禁止直接使用axios或fetch
**扩展点**: 可添加请求拦截器、认证token处理

#### `backtest.ts` - 回测业务API ⭐⭐⭐
**功能**: 回测相关的所有API调用 + TypeScript类型定义
**核心方法**:
- `strategyService.getStrategies()` - 获取策略列表
- `backtestService.runBacktest()` - 执行通用回测
- `backtestService.runDCABacktest()` - DCA策略专用简化调用
**类型定义**: `BacktestRequest`、`BacktestResult`、`Strategy`等完整类型
**使用场景**: 所有策略的后端交互必须通过此服务层

### 🖼️ **页面组件** (`/frontend/src/pages/`)

#### `StrategySelection.tsx` - 忍者风格策略选择页 ⭐⭐⭐
**功能**: 主页策略展示 + 忍者黑客终端风格UI
**核心特色**:
- Typewriter打字机效果 (`react-simple-typewriter`)
- 忍者情报网实时数据滚动显示
- 修行记录历史展示
- 完整的终端配色方案 (黑底绿字)
**可复用元素**: 终端头部、忍者配色、动画效果
**使用场景**: 所有新页面的UI风格参考标准

#### `DCA/` - DCA策略完整模块 ⭐⭐⭐
**结构**: 
```
DCA/
├── index.tsx           # 导出文件
├── DCAConfig.tsx       # 参数配置页面
├── DCAResult.tsx       # 结果展示页面  
└── components/         # 专用组件库
    ├── ETFSelector.tsx      # ETF选择器
    ├── FrequencySelect.tsx  # 频率选择器
    └── ParameterPreview.tsx # 参数预览器
```
**设计模式**: 策略独立开发模式的标准实现
**可复用**: 整个目录结构可作为新策略开发的模板
**扩展点**: components中的组件可抽象为全局通用组件

### 🛠️ **工具层** (`/frontend/src/utils/`)

#### `constants.ts` - 全局配置常量 ⭐⭐
**功能**: API地址、应用配置、业务常量的统一管理
**核心常量**:
- `API_BASE_URL` - 自动环境适配的API地址
- `RISK_LEVELS` - 风险等级配色配置  
- `MARKETS` - 市场类型图标配置
- `STRATEGY_CATEGORIES` - 策略分类映射
**使用场景**: 避免硬编码，所有常量必须在此文件定义
**扩展指南**: 新增常量按功能分类，保持注释说明

---

## ⚙️ **后端架构资产**

### 🧠 **核心引擎** (`/backend/app/core/`)

#### `strategy_registry.py` - 策略注册管理器 ⭐⭐⭐
**功能**: 单例模式的策略注册表，负责策略发现和管理
**核心方法**:
- `register_strategy()` - 策略注册
- `list_strategies()` - 获取策略列表
- `get_strategy_info()` - 获取策略详情
**设计模式**: 单例模式 + 策略模式
**扩展点**: 支持动态策略加载、策略版本管理

#### `data_source.py` - 统一数据源管理器 ⭐⭐⭐
**功能**: 抽象数据源接口，统一AKShare、yfinance等数据获取
**核心类**:
- `DataSource` - 抽象基类
- `AKShareDataSource` - A股数据源
- `YFinanceDataSource` - 美股数据源  
- `DataManager` - 数据源管理器(自动选择)
**使用场景**: 所有历史数据获取必须通过此管理器
**扩展点**: 可添加新数据源、缓存机制、数据质量检查

### 📡 **API层** (`/backend/app/api/`)

#### `strategies.py` - 策略管理API ⭐⭐
**功能**: 策略列表、详情、参数获取的REST API
**接口列表**:
- `GET /api/v1/strategies/` - 获取所有策略
- `GET /api/v1/strategies/{id}` - 获取策略详情
- `GET /api/v1/strategies/{id}/parameters` - 获取策略参数
**错误处理**: 统一HTTPException格式
**使用场景**: 前端策略选择页面的数据源

#### `backtest.py` - 回测执行API ⭐⭐⭐
**功能**: 统一的策略回测执行接口
**核心接口**: `POST /api/v1/backtest/run` - 执行策略回测
**数据处理**: 集成真实数据源 + Backtrader引擎
**错误处理**: 标准化HTTPException + 用户友好错误信息
**性能**: 包含数据质量检查、错误恢复机制

### 🎯 **策略实现** (`/backend/app/strategies/`)

#### `base.py` - 策略抽象基类 ⭐⭐⭐
**功能**: 基于Backtrader的策略基础类
**核心功能**: 
- 策略元数据定义
- 交易记录管理  
- 性能指标计算
**设计模式**: 模板方法模式
**扩展指南**: 所有新策略必须继承此基类

#### `dca_strategy.py` - DCA定投策略 ⭐⭐⭐
**功能**: 完整的定投策略实现
**参数**:
- `investment_amount` - 每期投资金额
- `frequency_days` - 投资频率天数
**核心逻辑**: 定期定额买入策略
**使用场景**: DCA策略标准实现，可作为新策略开发参考

---

## 🎨 **设计规范和模式**

### 🥷 **忍者黑客终端UI风格**
**配色方案**: 黑底 (#000) + 绿字 (#22c55e) + 灰色辅助
**核心元素**:
- 终端窗口头部 (红绿黄三色按钮)
- 命令行提示符风格
- Typewriter打字机效果
- 矩阵风格代码雨效果
**应用范围**: 所有页面保持统一风格

### 📁 **策略独立开发模式**
**目录结构**: `/pages/{StrategyName}/` + `components/` + `index.tsx`
**开发理念**: 先专用后通用，避免过早抽象
**标准流程**: DCA策略 → ETF轮动策略 → 识别抽象点 → 重构通用组件

---

## 📊 **开发统计**

### ✅ **已实现功能模块**
| 模块 | 前端完成度 | 后端完成度 | 联调状态 | 备注 |
|------|-----------|-----------|----------|------|
| 策略选择 | 95% | 90% | ✅ | 忍者风格完成 |
| DCA策略 | 95% | 95% | ✅ | 完整实现 | 
| API基础设施 | 90% | 95% | ✅ | axios重构完成 |

### 🔄 **待开发功能** (按优先级)
1. **ETF轮动策略** - 基于DCA模式开发
2. **策略对比功能** - 复用现有图表组件
3. **历史记录管理** - 复用现有API架构

---

## ⚠️ **常见陷阱避免**

### 🚫 **禁止行为**
- ❌ 直接使用axios而不通过api.ts
- ❌ 硬编码API地址而不使用环境变量
- ❌ 重复实现已有的service方法
- ❌ 创建新组件前不检查现有components
- ❌ 忽略现有的类型定义重新定义接口

### ✅ **推荐做法**
- ✅ 开发前先搜索本文档相关功能
- ✅ 复用现有组件和工具方法
- ✅ 新增功能立即更新此清单
- ✅ 保持与现有代码风格一致
- ✅ 遵循策略独立开发模式

---

## 📝 **更新日志**

### 2024-09-04
- 📄 创建架构资产清单文档
- 🔧 完成axios API重构，统一前端API调用
- 📋 更新CLAUDE.md开发流程规范，建立双模式工作机制
- ✅ DCA策略前后端完整联调完成

### 2024-09-03  
- 🥷 完成忍者黑客终端UI风格设计
- ✅ DCA策略前端页面重构完成
- 🔧 后端AKShare真实数据源集成完成

---

**文档维护**: 每次新增组件/工具/页面后必须更新对应章节  
**使用建议**: 开发前Ctrl+F搜索相关功能，避免重复开发  
**问题反馈**: 发现文档不准确或遗漏的组件请及时更新
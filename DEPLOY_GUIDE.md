# ğŸš€ é‡åŒ–å›æµ‹ç³»ç»Ÿè‡ªåŠ¨éƒ¨ç½²æŒ‡å—

> ä»é›¶å¼€å§‹ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ è®¾ç½®GitHubè‡ªåŠ¨éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨

## ğŸ“‹ ç›®å½•

- [å‰ç½®å‡†å¤‡](#å‰ç½®å‡†å¤‡)
- [Step 1: æœåŠ¡å™¨ç«¯é…ç½®](#step-1-æœåŠ¡å™¨ç«¯é…ç½®)
- [Step 2: æœ¬åœ°SSHå¯†é’¥é…ç½®](#step-2-æœ¬åœ°sshå¯†é’¥é…ç½®)
- [Step 3: GitHubé…ç½®](#step-3-githubé…ç½®)
- [Step 4: æµ‹è¯•éƒ¨ç½²](#step-4-æµ‹è¯•éƒ¨ç½²)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å‰ç½®å‡†å¤‡

### ä½ éœ€è¦æœ‰ï¼š
- âœ… ä¸€å°äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘/AWSç­‰ï¼‰
- âœ… æœåŠ¡å™¨å·²å®‰è£…Dockerå’ŒDocker Compose
- âœ… ä»£ç å·²ä¸Šä¼ åˆ°GitHub
- âœ… èƒ½SSHç™»å½•æœåŠ¡å™¨

### æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒï¼š
```bash
# SSHç™»å½•æœåŠ¡å™¨åæ‰§è¡Œ
docker --version          # åº”è¯¥æ˜¾ç¤ºDockerç‰ˆæœ¬
docker-compose --version  # åº”è¯¥æ˜¾ç¤ºDocker Composeç‰ˆæœ¬
```

å¦‚æœæ²¡å®‰è£…ï¼Œè¿è¡Œï¼š
```bash
# Ubuntu/Debianç³»ç»Ÿ
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo apt install docker-compose
```

---

## Step 1: æœåŠ¡å™¨ç«¯é…ç½®

### 1.1 å…‹éš†é¡¹ç›®åˆ°æœåŠ¡å™¨

```bash
# SSHç™»å½•ä½ çš„æœåŠ¡å™¨
ssh your-username@your-server-ip

# é€‰æ‹©é¡¹ç›®ç›®å½•ï¼ˆå»ºè®®ç”¨/optï¼‰
sudo mkdir -p /opt/quant-backtest
sudo chown $USER:$USER /opt/quant-backtest
cd /opt/quant-backtest

# å…‹éš†é¡¹ç›®ï¼ˆæ›¿æ¢ä¸ºä½ çš„GitHubä»“åº“åœ°å€ï¼‰
git clone https://github.com/YOUR-USERNAME/YOUR-REPO-NAME.git .

# ç»™éƒ¨ç½²è„šæœ¬æ‰§è¡Œæƒé™
chmod +x simple-deploy.sh
```

### 1.2 æµ‹è¯•æ‰‹åŠ¨éƒ¨ç½²

```bash
# æµ‹è¯•éƒ¨ç½²è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ
./simple-deploy.sh

# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f
```

**é¢„æœŸç»“æœ**ï¼š
- å‰ç«¯æœåŠ¡ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:3001
- åç«¯æœåŠ¡ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:8008

---

## Step 2: æœ¬åœ°SSHå¯†é’¥é…ç½®

### 2.1 ç”ŸæˆSSHå¯†é’¥å¯¹

**åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šæ‰§è¡Œ**ï¼š

```bash
# ç”Ÿæˆæ–°çš„SSHå¯†é’¥å¯¹ï¼ˆæ›¿æ¢your-email@example.comä¸ºä½ çš„é‚®ç®±ï¼‰
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# æç¤ºè¾“å…¥æ–‡ä»¶åæ—¶ï¼Œå¯ä»¥ç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤åç§°
# æç¤ºè®¾ç½®å¯†ç æ—¶ï¼Œå¯ä»¥ç›´æ¥å›è½¦ï¼ˆæ— å¯†ç ï¼‰
```

### 2.2 å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨

```bash
# æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥å†…å®¹
cat ~/.ssh/id_rsa.pub

# å¤åˆ¶è¿™æ®µå†…å®¹ï¼Œç„¶åSSHç™»å½•æœåŠ¡å™¨æ‰§è¡Œï¼š
```

**åœ¨æœåŠ¡å™¨ä¸Š**ï¼š
```bash
# åˆ›å»º.sshç›®å½•
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# æ·»åŠ å…¬é’¥åˆ°æˆæƒæ–‡ä»¶ï¼ˆå°†ä¸‹é¢çš„å†…å®¹æ›¿æ¢ä¸ºåˆšæ‰å¤åˆ¶çš„å…¬é’¥ï¼‰
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC... your-email@example.com" >> ~/.ssh/authorized_keys

# è®¾ç½®æ­£ç¡®æƒé™
chmod 600 ~/.ssh/authorized_keys
```

### 2.3 æµ‹è¯•SSHè¿æ¥

**åœ¨æœ¬åœ°æµ‹è¯•**ï¼š
```bash
# æµ‹è¯•æ— å¯†ç SSHç™»å½•ï¼ˆæ›¿æ¢ä¸ºä½ çš„æœåŠ¡å™¨ä¿¡æ¯ï¼‰
ssh your-username@your-server-ip

# å¦‚æœèƒ½ç›´æ¥ç™»å½•ä¸éœ€è¦å¯†ç ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼
```

---

## Step 3: GitHubé…ç½®

### 3.1 è·å–SSHç§é’¥å†…å®¹

**åœ¨æœ¬åœ°ç”µè„‘**ï¼š
```bash
# æŸ¥çœ‹ç§é’¥å†…å®¹ï¼ˆæ³¨æ„æ˜¯ç§é’¥ï¼Œæ²¡æœ‰.pubåç¼€ï¼‰
cat ~/.ssh/id_rsa

# å¤åˆ¶æ•´ä¸ªå†…å®¹ï¼Œä»-----BEGINå¼€å¤´åˆ°-----ENDç»“å°¾
```

### 3.2 è®¾ç½®GitHub Secrets

1. **æ‰“å¼€GitHubä»“åº“é¡µé¢**
2. **ç‚¹å‡»Settingsé€‰é¡¹å¡**
3. **å·¦ä¾§èœå•æ‰¾åˆ°"Secrets and variables" â†’ "Actions"**
4. **ç‚¹å‡»"New repository secret"**

**åˆ›å»ºä»¥ä¸‹3ä¸ªå¯†é’¥**ï¼š

| åç§° | å€¼ | è¯´æ˜ |
|------|----|----|
| `HOST` | `123.456.78.90` | ä½ çš„æœåŠ¡å™¨IPåœ°å€ |
| `USERNAME` | `ubuntu` | SSHç™»å½•ç”¨æˆ·å |
| `KEY` | `-----BEGIN OPENSSH PRIVATE KEY-----...` | å®Œæ•´çš„SSHç§é’¥å†…å®¹ |

**âš ï¸ é‡è¦æç¤º**ï¼š
- `KEY`çš„å€¼è¦åŒ…å«å®Œæ•´çš„ç§é’¥ï¼ŒåŒ…æ‹¬å¼€å¤´å’Œç»“å°¾çš„æ³¨é‡Šè¡Œ
- ä¸è¦åœ¨ç§é’¥å‰åæ·»åŠ é¢å¤–çš„ç©ºæ ¼æˆ–æ¢è¡Œ

### 3.3 ä¿®æ”¹éƒ¨ç½²è„šæœ¬è·¯å¾„

ç¼–è¾‘`.github/workflows/simple-deploy.yml`ï¼š

```yaml
# ä¿®æ”¹è¿™ä¸€è¡Œä¸ºä½ æœåŠ¡å™¨ä¸Šçš„å®é™…é¡¹ç›®è·¯å¾„
script: |
  cd /opt/quant-backtest  # æ”¹ä¸ºä½ çš„å®é™…è·¯å¾„
  git pull origin main
  docker-compose restart
```

---

## Step 4: æµ‹è¯•éƒ¨ç½²

### 4.1 æäº¤ä»£ç è§¦å‘éƒ¨ç½²

```bash
# åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•
git add .
git commit -m "è®¾ç½®è‡ªåŠ¨éƒ¨ç½²"
git push origin main
```

### 4.2 æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

1. **GitHubç½‘é¡µä¸ŠæŸ¥çœ‹**ï¼š
   - è¿›å…¥ä½ çš„ä»“åº“
   - ç‚¹å‡»"Actions"é€‰é¡¹å¡
   - åº”è¯¥èƒ½çœ‹åˆ°æ­£åœ¨è¿è¡Œçš„éƒ¨ç½²ä»»åŠ¡

2. **æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹**ï¼š
```bash
# SSHç™»å½•æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„æ›´æ–°
cd /opt/quant-backtest
git log --oneline -5  # æŸ¥çœ‹æœ€è¿‘5æ¬¡æäº¤

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps
```

### 4.3 éªŒè¯éƒ¨ç½²ç»“æœ

è®¿é—®ä½ çš„åº”ç”¨ï¼š
- å‰ç«¯ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:3001`
- åç«¯APIæ–‡æ¡£ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8008/docs`

**æˆåŠŸæ ‡å¿—**ï¼š
- âœ… GitHub Actionsæ˜¾ç¤ºç»¿è‰²âœ“
- âœ… ç½‘ç«™èƒ½æ­£å¸¸è®¿é—®
- âœ… åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## å¸¸è§é—®é¢˜

### âŒ SSHè¿æ¥å¤±è´¥

**é—®é¢˜**: `Permission denied (publickey)`

**è§£å†³**:
```bash
# 1. æ£€æŸ¥SSHæœåŠ¡çŠ¶æ€
sudo systemctl status ssh

# 2. æ£€æŸ¥authorized_keysæƒé™
ls -la ~/.ssh/
# authorized_keysåº”è¯¥æ˜¯600æƒé™

# 3. é‡å¯SSHæœåŠ¡
sudo systemctl restart ssh
```

### âŒ Gitæ‹‰å–å¤±è´¥

**é—®é¢˜**: `fatal: could not read Username for 'https://github.com'`

**è§£å†³**:
```bash
# åœ¨æœåŠ¡å™¨ä¸Šé…ç½®Gitï¼ˆå¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼‰
git config --global credential.helper store

# æˆ–è€…ä½¿ç”¨SSH URLå…‹éš†
git remote set-url origin git@github.com:USERNAME/REPO.git
```

### âŒ Dockeræƒé™é—®é¢˜

**é—®é¢˜**: `permission denied while trying to connect to the Docker daemon socket`

**è§£å†³**:
```bash
# å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
sudo usermod -aG docker $USER

# é‡æ–°ç™»å½•æˆ–æ‰§è¡Œ
newgrp docker
```

### âŒ ç«¯å£è¢«å ç”¨

**é—®é¢˜**: 3001æˆ–8008ç«¯å£è¢«å ç”¨

**è§£å†³**:
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E '(3001|8008)'

# ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
ports:
  - "3002:3001"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
  - "8009:8008"  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

### âŒ GitHub Actionså¤±è´¥

**é—®é¢˜**: éƒ¨ç½²ä»»åŠ¡å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥GitHub Secretsæ˜¯å¦æ­£ç¡®è®¾ç½®
2. æ£€æŸ¥æœåŠ¡å™¨è·¯å¾„æ˜¯å¦å­˜åœ¨
3. æ‰‹åŠ¨SSHåˆ°æœåŠ¡å™¨æµ‹è¯•å‘½ä»¤æ˜¯å¦èƒ½æ‰§è¡Œ
4. æŸ¥çœ‹Actionsæ—¥å¿—çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸå

### æ—¥å¸¸å·¥ä½œæµç¨‹ï¼š
1. æœ¬åœ°å¼€å‘ä»£ç 
2. `git add . && git commit -m "åŠŸèƒ½æè¿°"`
3. `git push origin main`
4. ç­‰å¾…30ç§’ï¼Œè‡ªåŠ¨éƒ¨ç½²å®Œæˆï¼

### ç›‘æ§å’Œç»´æŠ¤ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æ‰‹åŠ¨é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§è¿™ä¸ªæŒ‡å—è¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æ£€æŸ¥æ¯ä¸€æ­¥æ˜¯å¦ä¸¥æ ¼æŒ‰ç…§è¯´æ˜æ‰§è¡Œ**
2. **æŸ¥çœ‹GitHub Actionsçš„è¯¦ç»†æ—¥å¿—**
3. **SSHåˆ°æœåŠ¡å™¨æ‰‹åŠ¨æµ‹è¯•éƒ¨ç½²è„šæœ¬**
4. **ç¡®è®¤é˜²ç«å¢™æ˜¯å¦å¼€æ”¾äº†3001å’Œ8008ç«¯å£**

è®°ä½ï¼šç¬¬ä¸€æ¬¡é…ç½®å¯èƒ½ä¼šé‡åˆ°å„ç§å°é—®é¢˜ï¼Œä½†ä¸€æ—¦é…ç½®æˆåŠŸï¼Œåç»­å°±éå¸¸çˆ½äº†ï¼ğŸš€
# 量化回测系统 - 重构任务清单

> **最后更新**: 2024-09-02  
> **项目状态**: 架构重构阶段 - 基于Backtrader重建  
> **下一里程碑**: 极简架构设计和DCA策略重建

## 🔥 **重构背景**

2024-09-02 发现系统致命问题：
- ❌ **未使用Backtrader专业框架** - requirements.txt中被注释
- ❌ **自制SimpleBacktestEngine** - 功能有限，维护困难  
- ❌ **过度抽象设计** - 策略工厂、复杂API等增加复杂度
- ❌ **技术债务积累** - 偏离原始技术选型

**解决方案**: 激进重构，删除所有过度设计，基于Backtrader从零重建

## ✅ **重构进展**

### 第一阶段：清理完成 (2024-09-02)
- [x] **删除复杂抽象代码**
  - [x] 删除 backend/app/strategies/ - 策略工厂过度设计
  - [x] 删除 backend/app/core/ - 自制SimpleBacktestEngine  
  - [x] 删除 backend/app/services/ - 数据抽象层
  - [x] 删除 backend/app/schemas/ - API过度设计
  - [x] 删除 backend/app/models/ - 复杂数据模型
  - [x] 删除 backend/app/api/ - 复杂路由系统
- [x] **重建基础框架**  
  - [x] 创建极简 main.py (FastAPI基础)
  - [x] 启用 backtrader==1.9.78.123 依赖
  - [x] 更新项目文档状态

## 📋 **当前任务**

### 🎯 **第二阶段：架构设计** (进行中)
- [ ] **极简API设计讨论** `P0 高优先级`
  - [ ] 确定核心API接口 (4-6个)
  - [ ] 设计请求/响应格式
  - [ ] 前端兼容性考虑
- [ ] **Backtrader集成方案** `P0 高优先级`  
  - [ ] 数据源集成 (AKShare + yfinance)
  - [ ] 策略基类设计
  - [ ] 回测结果格式化
- [ ] **文件结构设计** `P0 高优先级`
  - [ ] 确定最小文件结构 
  - [ ] 代码组织原则
  - [ ] 模块划分方案

### 🔧 **第三阶段：核心实现** (待启动)
- [ ] **DCA策略重建** `P0 高优先级`
  - [ ] 基于Backtrader.Strategy实现
  - [ ] 参数配置系统
  - [ ] 信号生成逻辑
- [ ] **回测引擎集成** `P0 高优先级`
  - [ ] Backtrader Cerebro配置
  - [ ] 数据feed设置  
  - [ ] 性能分析器集成
- [ ] **API接口实现** `P0 高优先级`
  - [ ] 回测启动接口
  - [ ] 状态查询接口
  - [ ] 结果获取接口
  - [ ] 数据验证接口

### 🧪 **第四阶段：验证部署** (规划中)
- [ ] **功能验证** `P1 中优先级`
  - [ ] 与前端集成测试
  - [ ] DCA策略回测验证
  - [ ] 性能和稳定性测试
- [ ] **文档同步** `P1 中优先级`
  - [ ] 更新README.md架构说明
  - [ ] 更新QUICKSTART.md启动指南
  - [ ] 更新development.md开发文档

## 🎯 **设计原则**

### 极简至上
- 不超过5个Python文件
- 不超过500行核心代码
- 直接使用Backtrader，避免抽象层

### Backtrader优先
- 所有设计围绕Backtrader最佳实践
- 充分利用专业框架能力
- 遵循Backtrader设计模式

### 前端兼容  
- 保持前端代码不变
- API响应格式兼容
- 逐步优化用户体验

## 🚀 **下一步行动**

### 立即讨论 (今天)
1. **API接口设计** - 确定最小可用接口集合
2. **文件结构** - 决定代码组织方式  
3. **实现计划** - 制定开发时间表

### 本周目标 (2024-09-02 - 2024-09-08)
- [ ] 完成架构设计讨论
- [ ] 实现基础Backtrader集成
- [ ] 重建DCA策略核心功能

### 里程碑验证
- **M1**: 基础回测能跑起来
- **M2**: 前端能正常调用API
- **M3**: DCA策略结果正确

---

## 📞 **快速指令**

**重构状态查询:**
- 查看 `CLAUDE.md` 了解项目整体状态
- 查看 `TODO.md` (本文件) 了解重构进度

**开始设计讨论:**
直接告诉我你对架构设计的想法，我们立即开始讨论！
# 🥷 DCA终端化配置系统 PRD

## 📋 项目概览

**项目名称**：DCA终端化配置系统 (DCA Terminal Config System)  
**版本**：v2.0 - 单页面终端化重构版  
**项目类型**：终端风格单页面应用  
**目标用户**：专业投资人士/程序员  

## 🎯 核心需求

### 设计理念
- **真正的终端体验**：CMD风格但美观的单页面终端界面
- **单页面流程**：在一个终端窗口内完成：简介→配置→确认→执行→结果
- **ASCII艺术美学**：用ASCII字符创造卡片式交互，保持hacker调性
- **emoji灵动化**：合理使用emoji增加视觉识别度和界面活力
- **快捷化交互**：热门选项、快捷标签，减少用户操作成本
- **无分散路由**：避免多页面跳转，保持终端连续性

### ASCII艺术设计理念
1. **终端原生美学**：所有"卡片"都是ASCII字符边框，不破坏终端风格
2. **等宽字体对齐**：利用monospace字体特性，ASCII图形完美对齐
3. **符号状态表示**：用●○等符号表示选中状态，直观且极简
4. **悬浮交互效果**：ASCII边框在hover时变色，提供交互反馈
5. **功能性emoji**：emoji仅作为功能标识，增强而不替代终端美学

### 问题陈述
之前的多页面设计过于分散，"PLAYGAME"等游戏化元素出戏，表单式配置不够终端化。需要真正的单页面终端体验。

## 🎬 终端化用户流程设计

### 流程概览（单页面状态机）
```
🏠 策略大厅 → 🖥️ DCA终端配置页面 
   (选择DCA)   ↓
              📜 任务简介阶段 → ⚙️ 参数配置阶段 → 📋 流式确认阶段 → 🚀 执行阶段 → 📊 结果展示阶段
              (流式介绍)      (命令行风格)      (终端输出)      (进度显示)    (就地显示)
```

### 详细流程设计

#### 1. 🏠 策略选择页面
用户点击"DCA定投策略"进入 `/dca/terminal` 路由

#### 2. 🖥️ DCA终端页面 - 阶段一：任务简介
```
┌─ [●●●] ninja@hackermain:~/dca-mission ──────────────┐
│ Session: ninja@hackermain   PWD: ~/dca-mission      │
│ Status: ACTIVE                                      │
├─────────────────────────────────────────────────────┤
│                                                    │
│ ninja@hackermain:~$ init dca-mission               │
│ > 正在载入DCA渗透任务详情...                       │
│                                                   │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│ 📜 【DCA定投渗透任务】                            │ ← 流式输出
│                                                   │
│ 任务目标: 长期资产积累策略                         │
│ 难度等级: ★★☆☆☆                                  │
│ 预期收益: 年化 8-12%                              │
│ 执行方式: 定期定额投资                             │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│                                                   │
│ 策略简介: 通过固定时间间隔投资固定金额...          │
│                                                   │
│ [> 开始配置] [> 返回大厅]                         │ ← 像素风按钮
└───────────────────────────────────────────────────┘
```

#### 3. 🖥️ DCA终端页面 - 阶段二：参数配置
```
┌─ [●●●] ninja@hackermain:~/dca-mission ──────────────┐
│                                                    │
│ ninja@hackermain:~$ config --interactive          │
│                                                   │
│ > 目标资产 (TARGET_SYMBOL):                       │
│   [510300 - 沪深300ETF ▼]                        │ ← ninja风格表单
│                                                   │
│ > 投资金额 (INVESTMENT_AMOUNT):                   │
│   [1000] 元                                      │
│                                                   │
│ > 执行频率 (FREQUENCY_DAYS):                      │
│   [30] 天                                        │
│                                                   │
│ > 时间范围 (DATE_RANGE):                          │
│   [2021-01-01] 到 [2024-01-01]                   │
│                                                   │
│ > 初始资金 (INITIAL_CASH):                        │
│   [10000] 元                                     │
│                                                   │
│ [> 确认配置] [> 返回简介]                         │
└───────────────────────────────────────────────────┘
```

#### 4. 🖥️ DCA终端页面 - 阶段三：流式确认
```
┌─ [●●●] ninja@hackermain:~/dca-mission ──────────────┐
│                                                    │
│ ninja@hackermain:~$ cat dca_mission_config.json   │
│                                                   │
│ DCA_MISSION_CONFIG:                                │
│   TARGET_SYMBOL=510300                            │ ← 终端风格流式输出
│   INVESTMENT_AMOUNT=1000                          │
│   FREQUENCY_DAYS=30                               │
│   DATE_RANGE=2021-01-01:2024-01-01               │
│   INITIAL_CASH=10000                              │
│   EXPECTED_TRADES=36                              │
│                                                   │
│ [> 开始执行] [> 修改配置]                         │
└───────────────────────────────────────────────────┘
```

#### 5. 🖥️ DCA终端页面 - 阶段四：执行任务
```
┌─ [●●●] ninja@hackermain:~/dca-mission ──────────────┐
│                                                    │
│ ninja@hackermain:~$ execute dca-mission           │
│ > 正在执行DCA渗透任务...                          │
│                                                   │
│ > 目标锁定: 510300                                │
│ > 数据获取中...                                   │
│ > 策略执行中...                                   │
│ > 收益分析中...                                   │
│                                                   │
│ 请稍候，任务执行中...                             │ ← 执行期间
└───────────────────────────────────────────────────┘
```

#### 6. 🖥️ DCA终端页面 - 阶段五：结果展示
```
┌─ [●●●] ninja@hackermain:~/dca-mission ──────────────┐
│                                                    │
│ ✅ 任务执行完成！                                  │
│                                                   │
│ 任务执行结果:                                     │
│ ┌─────────────────────────────────────────────────┐│
│ │  执行次数: 36 次   总收益率: +45.2%             ││ ← 就地显示结果
│ │  最终资产: ¥145,200                            ││
│ └─────────────────────────────────────────────────┘│
│                                                   │
│ [> 查看详情] [> 新任务]                           │
└───────────────────────────────────────────────────┘
```

#### 5. 📋 任务情报页面（结果展示）
跳转到现有的DCAResult页面，但标题改为"任务情报"风格

## 🏗️ 技术架构设计

### 组件复用策略
```
📁 架构设计
├── 📁 通用终端组件 (90%复用)
│   ├── TerminalWindow.tsx       # 终端容器
│   ├── TerminalConfigItem.tsx   # 配置项包装器  
│   ├── TerminalSelect.tsx       # 选择器
│   ├── TerminalNumberInput.tsx  # 数字输入
│   └── TerminalDateRange.tsx    # 日期选择器
│
├── 📁 策略专用面板 (10%定制)
│   ├── DCAConfigPanel.tsx
│   ├── ETFRotationConfigPanel.tsx
│   └── [其他策略面板]
│
└── StrategyConfigWrapper.tsx    # 统一容器
```

### 数据流设计
```typescript
interface StrategyConfigProps {
  strategyId: string
  defaultValues: ConfigValues
  onSubmit: (config: ConfigValues) => void
  onBack: () => void
}
```

## 🎨 界面设计规范

### 布局方式：瀑布式终端输出
```
┌─ 🥷 [策略名称]任务配置 ─────────────────────┐
│                                          │
│ > 正在初始化任务参数...                   │
│                                          │
│ [√] 目标资产    510300 沪深300ETF         │
│ [√] 投入金额    ¥1000/月                 │
│ [√] 执行频率    每月15日                  │ ← 逐行展示
│ [ ] 时间范围    配置中...                │
│ [ ] 风险控制    待配置...                │
│                                          │
│ 📊 实时分析: 预期年化 8.5% | 风险 ●●○○○   │
│                                          │
│ [执行任务] [返回] [帮助]                  │ ← 鼠标操作，悬浮动效
└──────────────────────────────────────────┘
```

### 视觉风格
- **配色**：保持黑(#000000) + 绿(#22c55e) 主题
- **强调色**：黄色用于重要提示，青色用于状态指示
- **字体**：等宽字体 (monospace)
- **动效**：悬浮时的终端风格动画

## 🔧 功能组件设计

### 1. 复合输入组件

#### 执行频率选择器
```
┌─ 执行频率配置 ─────────────────────────────┐
│ 🎯 预设选项:                             │
│   ◉ 每月15日 (推荐)                      │
│   ○ 每周五                              │
│   ○ 每季末                              │
│                                          │
│ 🎲 随机模式:                             │
│   ○ 随机日期 (降低择时偏差)              │
│                                          │
│ ⚙️ 自定义:                              │
│   ○ 每 [__30__] 天执行一次               │
└──────────────────────────────────────────┘
```

#### 资产选择器
```
┌─ 目标资产选择 ─────────────────────────────┐
│ 🔥 热门选择:                             │
│   [510300] [SPY] [QQQ] [512100]          │
│                                          │
│ 🔍 搜索输入:                             │
│   [________________] 输入代码或名称        │
│                                          │
│ 📋 当前选择: 510300 沪深300ETF            │
└──────────────────────────────────────────┘
```

#### 时间范围配置器
```
┌─ 任务时间范围 ─────────────────────────────┐
│ ⚡ 快速选择:                             │
│   [最近1年] [最近3年] [最近5年]           │
│                                          │
│ 📅 精确配置:                             │
│   从 [2021-01-01] 到 [2024-01-01]       │
│      ↑点击弹出日历    ↑点击弹出日历        │
└──────────────────────────────────────────┘
```

### 2. 参数处理策略

#### 默认值优先策略
- **所有配置项都有合理默认值**，避免空值校验错误
- **减少打断性校验**，只在最终确认时做必要验证
- **智能推荐默认配置**，适合大部分用户使用

#### 默认配置方案
```javascript
const defaultConfig = {
  symbol: '510300',           // 沪深300ETF
  investmentAmount: 1000,     // 1000元/月
  frequencyDays: 30,          // 每月投资
  initialCash: 10000,         // 1万初始资金
  dateRange: '最近3年'        // 3年回测期
}
```

### 3. 交互细节设计

#### 打字机效果参数
- **打字速度**：150ms/字符（快速但不跳跃）
- **可跳过设置**：点击任意位置立即显示完整内容
- **只在首次显示时使用**，重复访问直接显示

#### 瀑布式配置展示
- **逐行出现间隔**：500ms
- **配置项状态**：[√] 已配置 | [○] 配置中 | [ ] 待配置
- **实时预览更新**：参数变化时立即更新预期收益

#### 红白机风格按钮
```css
/* 按钮样式参考 */
.retro-button {
  background: linear-gradient(#4a4a4a, #2a2a2a);
  border: 2px solid #22c55e;
  color: #22c55e;
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
.retro-button:hover {
  background: linear-gradient(#5a5a5a, #3a3a3a);
  box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
}
```

## 📝 开发任务拆解

### Phase 1: 页面结构开发 (优先级：最高)
- [ ] **任务简介页面** - 打字机效果 + 红白机按钮
- [ ] **任务配置页面** - 瀑布式配置界面
- [ ] **参数确认页面** - 配置总结展示
- [ ] **执行Loading页面** - 智能进度显示

### Phase 2: 核心组件开发 (优先级：高)
- [ ] `TypewriterText` - 打字机效果组件
- [ ] `RetroButton` - 红白机风格按钮
- [ ] `WaterfallConfig` - 瀑布式配置容器
- [ ] `ConfigItem` - 单个配置项组件
- [ ] `LoadingProgress` - 智能Loading组件

### Phase 3: 交互逻辑实现 (优先级：高)
- [ ] 页面间路由和状态管理
- [ ] 配置数据的默认值和验证
- [ ] 实时预览计算逻辑
- [ ] Loading时长智能判断

### Phase 4: 样式和动效 (优先级：中)
- [ ] 终端窗口样式统一
- [ ] 瀑布式出现动画
- [ ] 按钮悬浮动效
- [ ] 配置完成反馈动画

## 🎮 操作流程演示

### 完整操作路径演示

#### 🏠 步骤1：从任务大厅进入
```
用户在策略选择页面 → 点击"DCA定投策略"卡片 → 页面跳转到任务简介
```

#### 📜 步骤2：任务简介页面
```
页面加载：
┌─ 显示终端窗口
│ > 正在载入任务详情...
│ (光标闪烁2秒)
│
│ 📜 【DCA定投渗透任务】    ← 打字机效果，150ms/字符
│ 
│ 任务目标：长期资产积累策略  ← 继续打字机效果
│ 难度等级：★★☆☆☆
│ 预期收益：年化 8-12%
│ 执行方式：定期定额投资
│
│ 策略简介：通过固定时间间隔投资固定金额到指定ETF产品，
│ 利用时间复利效应和成本平均化降低投资风险，适合长期
│ 财富积累的投资者...
│
│ (所有文字显示完成后，按钮出现)
│ ┌─────────────┐  ┌─────────────┐
│ │ > PLAY GAME │  │ > 返回大厅   │  ← 红白机风格，带悬浮动效
│ └─────────────┘  └─────────────┘
└─

用户操作：
- 可以点击任意位置跳过打字机效果
- 点击"PLAY GAME"进入配置页面
- 点击"返回大厅"回到策略选择页面
```

#### ⚙️ 步骤3：任务配置页面（瀑布式）
```
页面进入后：
┌─ 🥷 DCA任务配置终端
│ > 正在初始化任务参数...
│ (等待1秒)
│
│ [○] 目标资产    配置中...          ← 第1个配置项出现
│ (等待500ms)
│ [√] 目标资产    510300 沪深300ETF  ← 配置项完成，显示默认值
│ (等待500ms)
│ [○] 投入金额    配置中...          ← 第2个配置项出现
│ (等待500ms)  
│ [√] 投入金额    ¥1000/月           ← 显示默认值
│ ... (继续瀑布式显示其他配置项)
│
│ [√] 目标资产    510300 沪深300ETF
│ [√] 投入金额    ¥1000/月
│ [√] 执行频率    每月15日
│ [√] 时间范围    最近3年
│ [√] 初始资金    ¥10000
│
│ 📊 配置预览: 36次投资 | 预期年化 8.5%  ← 实时预览
│
│ [确认执行] [重新配置]
└─

用户操作：
- 每个配置项都可以点击修改（使用现有的ninja-input样式组件）
- 修改后实时更新预览信息
- 点击"确认执行"进入参数确认页面
```

#### 📋 步骤4：参数确认页面
```
显示配置总结：
┌─ 📋 任务参数确认
│ 🥷 忍者，请确认本次渗透任务参数：
│
│ > 目标资产: 510300 沪深300ETF
│ > 投资金额: ¥1000/月
│ > 执行频率: 每月15日  
│ > 时间范围: 2021-01-01 ~ 2024-01-01
│ > 初始资金: ¥10000
│
│ > 预计执行: 36次定投操作
│ > 预期收益: 年化 8.5%
│
│ [开始执行] [修改配置]
└─

用户操作：
- 最后确认机会，点击"开始执行"进入Loading
- 点击"修改配置"返回配置页面
```

#### 🚀 步骤5：执行阶段（智能Loading）
```
Loading开始：
┌─ 🥷 任务执行中
│ > 正在执行DCA渗透任务...
│
│ > 目标锁定: 510300 沪深300ETF
│ > 数据获取: ████████████████████ 100%
│ > 策略执行: ████████████████████ 100%    ← 进度条动画
│ > 收益分析: ████████████████████ 100%
│
│ ✅ 任务执行完成！
│ ✅ 成功执行 36 次定投操作  
│ ✅ 总收益率: +45.2%
│
│ [查看任务情报] [执行新任务]
└─

智能Loading逻辑：
- 如果后端响应 < 2秒：直接跳到完成状态
- 如果后端响应 2-10秒：显示进度条和参数回显
- 如果后端响应 > 10秒：显示详细执行日志
```

#### 📋 步骤6：查看任务情报
```
点击"查看任务情报"后跳转到DCAResult页面
- 页面标题改为"任务情报"风格
- 其他内容保持现有的结果展示逻辑
```

## 🎯 验收标准

### 功能验收
- [ ] 所有配置项都能正确输入和验证
- [ ] 复杂组件(频率、资产、时间)功能完整
- [ ] 返回和导航功能正常
- [ ] 配置数据正确传递给回测接口

### 体验验收  
- [ ] 符合忍者终端的沉浸感
- [ ] 瀑布式配置流程顺畅
- [ ] 鼠标操作流畅，无卡顿
- [ ] 移动端适配良好(如需要)

### 技术验收
- [ ] 组件复用率达到90%以上
- [ ] 新增策略只需编写专用面板  
- [ ] 代码结构清晰，易于维护
- [ ] 类型安全，无TypeScript错误

## 🔮 扩展规划

### 短期扩展 (1-2个策略)
- ETF轮动策略配置面板
- 网格交易策略配置面板

### 中期扩展 (高级配置)
- 换手率限制配置
- 节假日交易设置  
- 止损止盈参数
- 自定义交易日历

### 长期扩展 (个性化)
- 配置模板保存/加载
- 历史配置记录
- 配置分享功能

---

**文档状态**：待Review ✏️  
**预计工期**：2-3天开发 + 1天测试  
**风险评估**：低风险，主要是UI组件开发